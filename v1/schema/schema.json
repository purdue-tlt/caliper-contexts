{
	"title": "JSON Schema for IMS Global Caliper",
	"$schema": "http://json-schema.org/draft-04/schema#",
	"type": "object",
	"description": "JSON Schema for Caliper v1",
	"version": "1",
	"properties": {
		"sensor": {
			"type": "string",
			"format": "uri"
		},
		"sendTime": {
			"$ref": "#/definitions/DateTime"
		},
		"data": {
			"type": "array",
			"minItems": 1,
			"items": {
				"allOf": [{
					"$ref": "#/definitions/AnyEvent"
				}]
			}
		}
	},
	"required": [
		"sensor",
		"sendTime",
		"data"
	],
	"definitions": {
		"NullableString": {
			"type": [
				"string",
				"null"
			]
		},
		"ISODateTime": {
			"description": "ISO 8601 date format string yyyy-MM-dd'T'HH:mm:ss.SSS with optional .SSS milliseconds",
			"type": "string",
			"pattern": "^\\d{4}-[01]\\d-[0-3]\\d(T[0-2]\\d:[0-5]\\d(:[0-5]\\d)?([\\.,]\\d{1,3})?(Z|[+-][0-2]\\d(:?[0-5]\\d)?)?)?$"
		},
		"UNIXTimeStamp": {
			"description": "10-digit UNIX timestamp, epoch time",
			"type": "integer",
			"minimum": 0,
			"maximum": 9999999999
		},
		"DateTime": {
			"anyOf": [{
				"$ref": "#/definitions/ISODateTime"
			}, {
				"$ref": "#/definitions/UNIXTimeStamp"
			}, {
				"type": "string",
				"format": "date-time"
			}]
		},
		"NullableDateTime": {
			"oneOf": [{
				"$ref": "#/definitions/DateTime"
			}, {
				"type": "null"
			}]
		},
		"Duration": {
			"$ref": "#/definitions/NullableString"
		},

		"JsonLdContext": {
			"description": "A link to a valid JSON-LD context file, that maps term names to contexts.",
			"oneOf": [{
				"type": "string",
				"format": "uri"
			}, {
				"type": "array",
				"items": {
					"oneOf": [{
						"type": "string",
						"format": "uri"
					}, {
						"type": "object"
					}]
				}
			}]
		},
		"JsonLdType": {
			"description": "A type or an array of types that the object represents.",
			"oneOf": [{
				"type": "string",
				"format": "uri"
			}, {
				"type": "array",
				"items": {
					"type": "string",
					"format": "uri"
				}
			}]
		},
		"JsonLdObject": {
			"type": "object",
			"description": "Base json-ld object, with @context and @type",
			"@context": {
				"$ref": "#/definitions/JsonLdContext"
			},
			"@type": {
				"$ref": "#/definitions/JsonLdType"
			},
			"required": [
				"@context",
				"@type"
			],
		},

		"schema:Thing": {
			"type": "object",
			"description": "http://schema.org/Thing"
		},
		"schema:CreativeWork": {
			"description": "http://schema.org/CreativeWork",
			"allOf": [{
				"$ref": "#/definitions/schema:Thing"
			}]
		},
		"schema:SoftwareApplication": {
			"description": "http://schema.org/SoftwareApplication",
			"allOf": [{
				"$ref": "#/definitions/schema:CreativeWork"
			}]
		},

		"foaf:Agent": {
			"description": "An entity that can do things. Typical kinds of agents include people, organizations and software systems. See http://xmlns.com/foaf/spec/#term_Agent",
			"$ref": "#/definitions/JsonLdObject"
		},

		"w3c:Organization": {
			"type": "object",
			"properties": {
				"subOrganizationOf": {
					"anyOf": [{
						"$ref": "#/definitions/w3c:Organization"
					}, {
						"type": "null"
					}]
				}
			}
		},
		"w3c:Role": {
			"type": "string",
			"format": "uri"
		},
		"w3c:Status": {
			"type": "string",
			"format": "uri"
		},
		"w3c:Membership": {
			"type": "object",
			"properties": {
				"member": {
					"oneOf": [{
						"$ref": "#/definitions/foaf:Agent"
					}, {
						"type": "string",
						"format": "uri"
					}, {
						"type": "null"
					}]
				},
				"organization": {
					"oneOf": [{
						"$ref": "#/definitions/w3c:Organization"
					}, {
						"type": "string",
						"format": "uri"
					}, {
						"type": "null"
					}]
				},
				"roles": {
					"oneOf": [{
						"type": "array",
						"items": {
							"$ref": "#/definitions/w3c:Role"
						}
					}, {
						"type": "null"
					}]
				},
				"status": {
					"oneOf": [{
						"$ref": "#/definitions/w3c:Status"
					}, {
						"type": "null"
					}]
				}
			}
		},

		"caliper:Context": {
			"allOf": [{
				"$ref": "#/definitions/JsonLdContext"
			}],
			"type": "string",
			"format": "regex",
			"pattern": "http://purl.imsglobal.org/ctx/caliper/v1/Context"
		},
		"caliper:Object": {
			"description": "Base Caliper object, with caliper:Context",
			"allOf": [{
				"$ref": "#/definitions/JsonLdObject"
			}],
			"properties": {
				"@context": {
					"$ref": "#/definitions/caliper:Context"
				}
			}
		},
		"caliper:Entity": {
			"description": "Base Caliper Entity. Analogous to a Thing (https://schema.org/Thing)",
			"allOf": [{
				"$ref": "#/definitions/schema:Thing"
			}, {
				"$ref": "#/definitions/caliper:Object"
			}],
			"properties": {
				"name": {
					"$ref": "#/definitions/NullableString"
				},
				"description": {
					"$ref": "#/definitions/NullableString"
				},
				"extensions": {
					"type": "object"
				},
				"dateCreated": {
					"$ref": "#/definitions/NullableDateTime"
				},
				"dateModified": {
					"$ref": "#/definitions/NullableDateTime"
				},
			}
		},
		"caliper:DigitalResource": {
			"description": "Caliper representation of a CreativeWork (https://schema.org/CreativeWork)",
			"allOf": [{
				"$ref": "#/definitions/schema:CreativeWork"
			}, {
				"$ref": "#/definitions/caliper:Object"
			}],
			"properties": {
				"@type": {
					"type": "string",
					"format": "regex",
					"pattern": "http://purl.imsglobal.org/caliper/v1/DigitalResource"
				},
				"objectType": {
					"type": "array",
					"items": {
						"type": "string"
					}
				},
				"alignedLearningObjective": {
					"type": "array",
					"items": {
						"$ref": "#/definitions/caliper:LearningObjective"
					}
				},
				"keywords": {
					"type": "array",
					"items": {
						"type": "string"
					}
				},
				"isPartOf": {
					"$ref": "#/definitions/schema:CreativeWork"
				},
				"datePublished": {
					"description": "http://schema.org/datePublished",
					"$ref": "#/definitions/NullableDateTime"
				},
				"version": {
					"type": "string"
				}
			}
		},
		"caliper:LearningObjective": {
			"allOf": [{
				"$ref": "#/definitions/caliper:Entity"
			}],
			"properties": {
				"@type": {
					"type": "string",
					"format": "regex",
					"pattern": "http://purl.imsglobal.org/caliper/v1/LearningObjective"
				}
			}
		},
		"caliper:WebPage": {
			"allOf": [{
				"$ref": "#/definitions/caliper:Entity"
			}],
			"properties": {
				"@type": {
					"type": "string",
					"format": "regex",
					"pattern": "http://purl.imsglobal.org/caliper/v1/WebPage"
				}
			}
		},

		"caliper:lis:Person": {
			"allOf": [{
				"$ref": "#/definitions/foaf:Agent"
			}, {
				"$ref": "#/definitions/caliper:Entity"
			}],
			"properties": {
				"@type": {
					"type": "string",
					"format": "regex",
					"pattern": "http://purl.imsglobal.org/caliper/v1/lis/Person"
				}
			}
		},
		"caliper:SoftwareApplication": {
			"allOf": [{
				"$ref": "#/definitions/schema:SoftwareApplication"
			}, {
				"$ref": "#/definitions/foaf:Agent"
			}, {
				"$ref": "#/definitions/caliper:Entity"
			}],
			"properties": {
				"@type": {
					"type": "string",
					"format": "regex",
					"pattern": "http://purl.imsglobal.org/caliper/v1/SoftwareApplication"
				}
			}
		},
		"caliper:Organization": {
			"description": "A collection of people organized together into a community or other social, commercial or political structure. The group has some common purpose or reason for existence which goes beyond the set of people belonging to it and can act as an Agent. Organizations are often decomposable into hierarchical structures.",
			"allOf": [{
				"$ref": "#/definitions/w3c:Organization"
			}, {
				"$ref": "#/definitions/foaf:Agent"
			}, {
				"$ref": "#/definitions/caliper:Entity"
			}],
			"properties": {
				"@type": {
					"type": "string",
					"format": "regex",
					"pattern": "http://purl.imsglobal.org/caliper/v1/lis/Organization"
				}
			}
		},

		"caliper:lis:Group": {
			"description": "A Caliper LIS Group represents a Course substructure that a Person is able to join as a member.",
			"allOf": [{
				"$ref": "#/definitions/w3c:Organization"
			}, {
				"$ref": "#/definitions/caliper:Entity"
			}],
			"properties": {
				"@type": {
					"type": "string",
					"format": "regex",
					"pattern": "http://purl.imsglobal.org/caliper/v1/lis/Group"
				}
			}
		},
		"caliper:lis:Role": {
			"allOf": [{
				"$ref": "#/definitions/w3c:Role"
			}],
			/* "enum": [] TODO: Add all Role values */
		},
		"caliper:lis:Status": {
			"allOf": [{
				"$ref": "#/definitions/w3c:Status"
			}],
			"enum": [
				"http://purl.imsglobal.org/vocab/lis/v2/status#Active",
				"http://purl.imsglobal.org/vocab/lis/v2/status#Deleted",
				"http://purl.imsglobal.org/vocab/lis/v2/status#Inactive"
			]
		},
		"caliper:lis:Membership": {
			"description": "A Caliper Membership is used to define the relationship between objects that can have memberIds and objects that can be memberIds. Objects recognized as having memberIds are CourseOffering, CourseSection and Group, all of which implement the Joinable marker interface. Only a Person object can be a memberId.",
			"allOf": [{
				"$ref": "#/definitions/w3c:Membership"
			}, {
				"$ref": "#/definitions/caliper:Entity"
			}],
			"properties": {
				"@type": {
					"type": "string",
					"format": "regex",
					"pattern": "http://purl.imsglobal.org/caliper/v1/lis/Membership"
				},
				"member": {
					"oneOf": [{
						"$ref": "#/definitions/caliper:lis:Person"
					}, {
						"type": "string"
					}]
				},
				"roles": {
					"type": "array",
					"items": {
						"$ref": "#/definitions/caliper:lis:Role"
					}
				},
				"status": {
					"$ref": "#/definitions/caliper:lis:Status"
				}
			}
		},
		"caliper:lis:CourseOffering": {
			"description": "A CourseOffering is the occurrence of a course in a specific term, semester, etc.  A Caliper CourseOffering provides a subset of the CourseOffering properties specified in the IMS LTI 2.0 specification, which in turn, draws inspiration from the IMS LIS 1.0 specification.",
			"allOf": [{
				"$ref": "#/definitions/w3c:Organization"
			}, {
				"$ref": "#/definitions/caliper:Entity"
			}],
			"properties": {
				"@type": {
					"type": "string",
					"format": "regex",
					"pattern": "http://purl.imsglobal.org/caliper/v1/lis/CourseOffering"
				},
				"courseNumber": {
					"$ref": "#/definitions/NullableString"
				},
				"academicSession": {
					"$ref": "#/definitions/NullableString"
				}
			}
		},
		"caliper:lis:CourseSection": {
			"description": "A CourseSection is a way to represent a group of people associated with a course or class. These groups may include everyone in the class or course, or may be subsets of that whole group. CourseSections may have sub-sections (these are created as separate Group objects linked using the relationship). Examples of a CourseSection are Lecture, Laboratory, Studio, Seminar, etc. There may be several instances of a type of CourseSection e.g., multiple lectures. A Caliper CourseSection provides a subset of the CourseSection properties specified in the IMS LTI 2.0 specification, which in turn, draws inspiration from the IMS LIS 1.0 specification.",
			"allOf": [{
				"$ref": "#/definitions/caliper:lis:CourseOffering"
			}],
			"properties": {
				"@type": {
					"type": "string",
					"format": "regex",
					"pattern": "http://purl.imsglobal.org/caliper/v1/lis/CourseSection"
				},
				"category": {
					"$ref": "#/definitions/NullableString"
				}
			}
		},

		"caliper:AssignableDigitalResource": {
			"allOf": [{
				"$ref": "#/definitions/caliper:DigitalResource"
			}],
			"properties": {
				"@type": {
					"type": "string",
					"format": "regex",
					"pattern": "http://purl.imsglobal.org/caliper/v1/AssignableDigitalResource"
				},
				"dateToActivate": {
					"$ref": "#/definitions/NullableDateTime"
				},
				"dateToShow": {
					"$ref": "#/definitions/NullableDateTime"
				},
				"dateToStartOn": {
					"$ref": "#/definitions/NullableDateTime"
				},
				"dateToSubmit": {
					"$ref": "#/definitions/NullableDateTime"
				},
				"maxAttempts": {
					"type": "integer"
				},
				"maxSubmits": {
					"type": "integer"
				},
				"maxScore": {
					"type": "number"
				}
			}
		},
		"caliper:AssessmentItem": {
			"allOf": [{
				"$ref": "#/definitions/caliper:AssignableDigitalResource"
			}],
			"properties": {
				"@type": {
					"type": "string",
					"format": "regex",
					"pattern": "http://purl.imsglobal.org/caliper/v1/AssessmentItem"
				},
				"isTimeDependent": {
					"type": "boolean"
				}
			}
		},
		"caliper:Assessment": {
			"allOf": [{
				"$ref": "#/definitions/caliper:DigitalResource"
			}],
			"properties": {
				"@type": {
					"type": "string",
					"format": "regex",
					"pattern": "http://purl.imsglobal.org/caliper/v1/Assessment"
				},
				"assessmentItems": {
					"type": "array",
					"items": {
						"$ref": "#/definitions/caliper:AssessmentItem"
					}
				}
			}
		},
		"caliper:Attempt": {},

		"caliper:Session": {
			"description": "Caliper Session",
			"allOf": [{
				"$ref": "#/definitions/caliper:Entity"
			}],
			"properties": {
				"@type": {
					"type": "string",
					"format": "regex",
					"pattern": "http://purl.imsglobal.org/caliper/v1/Session"
				},
				"actor": {
					"$ref": "#/definitions/AnyAgent"
				},
				"startedAtTime": {
					"$ref": "#/definitions/NullableDateTime"
				},
				"endedAtTime": {
					"$ref": "#/definitions/NullableDateTime"
				},
				"duration": {
					"$ref": "#/definitions/Duration"
				}
			}
		},

		"caliper:Action": {
			"type": "string",
			"format": "uri"
		},

		"caliper:Event": {
			"description": "Core caliper event structure and base class for all events",
			"allOf": [{
				"$ref": "#/definitions/caliper:Object"
			}],
			"properties": {
				"actor": {
					"$ref": "#/definitions/AnyAgent"
				},
				"action": {
					"$ref": "#/definitions/caliper:Action"
				},
				"object": {
					"$ref": "#/definitions/caliper:Entity"
				},
				"generated": {
					"oneOf": [{
						"$ref": "#/definitions/caliper:Entity"
					}, {
						"type": "null"
					}]
				},
				"target": {
					"oneOf": [{
						"$ref": "#/definitions/caliper:Entity"
					}, {
						"type": "null"
					}]
				},
				"federatedSession": {
					"$ref": "#/definitions/NullableString"
				},
				"edApp": {
					"oneOf": [{
						"$ref": "#/definitions/caliper:SoftwareApplication"
					}, {
						"type": "null"
					}]
				},
				"group": {
					"oneOf": [{
						"$ref": "#/definitions/w3c:Organization"
					}, {
						"type": "null"
					}]
				},
				"membership": {
					"oneOf": [{
						"$ref": "#/definitions/caliper:lis:Membership"
					}, {
						"type": "null"
					}]
				},
				"eventTime": {
					"$ref": "#/definitions/DateTime"
				}
			},
			"required": [
				"actor",
				"action",
				"object",
				"eventTime"
			]
		},
		"caliper:SessionEvent": {
			"allOf": [{
				"$ref": "#/definitions/caliper:Event"
			}],
			"properties": {
				"@type": {
					"type": "string",
					"format": "regex",
					"pattern": "http://purl.imsglobal.org/caliper/v1/SessionEvent"
				},
				"generated": {
					"$ref": "#/definitions/caliper:Session"
				}
			},
			"oneOf": [{
				"properties": {
					"action": {
						"type": "string",
						"format": "regex",
						"pattern": "http://purl.imsglobal.org/vocab/caliper/v1/action#LoggedOut"
					},
					"generated": {
						"properties": {
							"endedAtTime": {
								"$ref": "#/definitions/DateTime"
							}
						},
						"required": ["endedAtTime"]
					}
				}
			}, {
				"properties": {
					"action": {
						"type": "string",
						"format": "regex",
						"pattern": "http://purl.imsglobal.org/vocab/caliper/v1/action#LoggedIn"
					},
					"generated": {
						"properties": {
							"startedAtTime": {
								"$ref": "#/definitions/DateTime"
							}
						},
						"required": ["startedAtTime"]
					}
				}
			}, {
				"properties": {
					"action": {
						"type": "string",
						"format": "regex",
						"pattern": "http://purl.imsglobal.org/vocab/caliper/v1/action#TimedOut"
					}
				}
			}]
		},
		"caliper:AssessmentEvent": {
			"allOf": [{
				"$ref": "#/definitions/caliper:Event"
			}]
		},
		"caliper:AssessmentItemEvent": {
			"allOf": [{
				"$ref": "#/definitions/caliper:Event"
			}]
		},
		"caliper:AnnotationEvent": {
			"allOf": [{
				"$ref": "#/definitions/caliper:Event"
			}]
		},
		"caliper:AssignableEvent": {
			"allOf": [{
				"$ref": "#/definitions/caliper:Event"
			}]
		},
		"caliper:MediaEvent": {
			"allOf": [{
				"$ref": "#/definitions/caliper:Event"
			}]
		},
		"caliper:NavigationEvent": {
			"allOf": [{
				"$ref": "#/definitions/caliper:Event"
			}]
		},
		"caliper:OutcomeEvent": {
			"allOf": [{
				"$ref": "#/definitions/caliper:Event"
			}]
		},
		"caliper:ReadingEvent": {
			"allOf": [{
				"$ref": "#/definitions/caliper:Event"
			}]
		},
		"caliper:ViewEvent": {
			"allOf": [{
				"$ref": "#/definitions/caliper:Event"
			}]
		},

		"AnyAgent": {
			"description": "Collection of all Caliper Agents",
			"anyOf": [{
				"$ref": "#/definitions/caliper:lis:Person"
			}, {
				"$ref": "#/definitions/caliper:SoftwareApplication"
			}, {
				"$ref": "#/definitions/caliper:Organization"
			}]
		},
		"AnyEvent": {
			"description": "Collection of all Caliper Events",
			"anyOf": [{
				"$ref": "#/definitions/caliper:SessionEvent"
			}]
		}
	}
}
